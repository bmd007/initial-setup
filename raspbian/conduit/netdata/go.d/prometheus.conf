jobs:
  - name: conduit
    # Use Docker internal network - 'conduit' resolves to the container IP
    # This traffic stays within Docker and doesn't go through the host network
    url: http://conduit:9090/metrics
    update_every: 5

    # Filter to only collect Conduit-specific metrics
    selector:
      allow:
        - conduit_*
        - go_*
        - process_*

    # Define custom charts for Conduit metrics
    charts:
      # Active Connections (Main metric)
      - id: conduit.connections
        title: "Conduit Client Connections"
        family: connections
        context: conduit.connections
        type: line
        units: "clients"
        priority: 1000
        dimensions:
          - name: conduit_connected_clients
            algorithm: absolute
          - name: conduit_connecting_clients
            algorithm: absolute

      # Capacity Usage
      - id: conduit.capacity
        title: "Conduit Capacity"
        family: capacity
        context: conduit.capacity
        type: line
        units: "clients"
        priority: 1010
        dimensions:
          - name: conduit_max_clients
            algorithm: absolute

      # Bandwidth
      - id: conduit.bandwidth_bytes
        title: "Conduit Bandwidth (Bytes)"
        family: bandwidth
        context: conduit.bandwidth
        type: line
        units: "bytes"
        priority: 1020
        dimensions:
          - name: conduit_bytes_uploaded
            algorithm: incremental
          - name: conduit_bytes_downloaded
            algorithm: incremental

      # Bandwidth Limit
      - id: conduit.bandwidth_limit
        title: "Conduit Bandwidth Limit"
        family: bandwidth
        context: conduit.bandwidth_limit
        type: line
        units: "bytes/sec"
        priority: 1030
        dimensions:
          - name: conduit_bandwidth_limit_bytes_per_second
            algorithm: absolute

      # Status
      - id: conduit.status
        title: "Conduit Broker Status"
        family: status
        context: conduit.status
        type: line
        units: "boolean"
        priority: 1040
        dimensions:
          - name: conduit_is_live
            algorithm: absolute

      # Uptime
      - id: conduit.uptime
        title: "Conduit Uptime"
        family: status
        context: conduit.uptime
        type: line
        units: "seconds"
        priority: 1050
        dimensions:
          - name: conduit_uptime_seconds
            algorithm: absolute

      # Go Runtime - Memory
      - id: conduit.go_memory
        title: "Conduit Memory Usage"
        family: runtime
        context: conduit.memory
        type: stacked
        units: "bytes"
        priority: 2000
        dimensions:
          - name: go_memstats_alloc_bytes
            algorithm: absolute
          - name: go_memstats_heap_inuse_bytes
            algorithm: absolute

      # Go Runtime - Goroutines
      - id: conduit.go_goroutines
        title: "Conduit Goroutines & Threads"
        family: runtime
        context: conduit.goroutines
        type: line
        units: "count"
        priority: 2010
        dimensions:
          - name: go_goroutines
            algorithm: absolute
          - name: go_threads
            algorithm: absolute

      # Process CPU
      - id: conduit.process_cpu
        title: "Conduit CPU Time"
        family: process
        context: conduit.cpu
        type: line
        units: "seconds"
        priority: 2020
        dimensions:
          - name: process_cpu_seconds_total
            algorithm: incremental

      # Process Network
      - id: conduit.process_network
        title: "Conduit Process Network I/O"
        family: process
        context: conduit.network
        type: line
        units: "bytes"
        priority: 2030
        dimensions:
          - name: process_network_receive_bytes_total
            algorithm: incremental
          - name: process_network_transmit_bytes_total
            algorithm: incremental
